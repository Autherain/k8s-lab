# =============================================================================
# LEFTHOOK - Git Hooks Configuration
# =============================================================================
#
# Ce fichier configure les hooks Git pour exécuter automatiquement :
# - tflint : linting du code Terraform
# - golangci-lint : linting du code Go
# - detect-secrets : détection de secrets dans le code
#
# Installation : lefthook install
# =============================================================================

pre-commit:
  parallel: true
  commands:
    terraform-fmt:
      glob: "terraform/*.tf"
      run: terraform -chdir=terraform fmt -check -recursive
      fail_text: "❌ terraform fmt a détecté des différences de formatage"

    tflint:
      glob: "terraform/*.tf"
      run: tflint --chdir=terraform --config=../.tflint.hcl
      fail_text: "❌ tflint a détecté des problèmes dans le code Terraform"

    terraform-init:
      glob: "terraform/*.tf"
      run: terraform -chdir=terraform init -backend=false -input=false
      fail_text: "❌ terraform init a échoué"

    golangci-lint:
      glob: "scripts/**/*.go"
      root: "scripts/terraform/get-cluster-info/"
      run: golangci-lint run --config=../../../.golangci.yml ./...
      fail_text: "❌ golangci-lint a détecté des problèmes dans le code Go"

    detect-secrets:
      run: detect-secrets-hook --baseline .secrets.baseline --exclude-files '_test\.go$' 'example$' {staged_files}
      fail_text: "❌ Des secrets potentiels ont été détectés ! Vérifiez vos fichiers."
